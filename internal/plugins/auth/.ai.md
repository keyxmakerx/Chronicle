# Auth Plugin

<!-- Core plugin -- always enabled, cannot be disabled. -->

## Purpose

Handles user authentication, session management, and password security for
Chronicle. Provides login, registration, logout, and session validation.
All other plugins depend on auth for user context.

## Tier

Plugin (Core -- always enabled)

## Domain Concepts

- **User:** A registered account with email, password, and profile info.
- **Session:** A server-side record (stored in Redis) linking a cookie to a user.
- **PASETO Token:** Secure token format used for sessions and API auth.

## Files

| File | Purpose |
|------|---------|
| handler.go | Login, register, logout HTTP handlers |
| service.go | Password hashing (argon2id), session creation, validation |
| repository.go | User table CRUD queries |
| model.go | User model, LoginRequest, RegisterRequest DTOs |
| routes.go | Public routes (/login, /register, /logout) |
| templates/ | Login form, register form Templ pages |

## Dependencies

- **Uses:** internal/database (MariaDB, Redis), internal/apperror
- **Used by:** Every other plugin (via auth middleware)

## Routes

| Method | Path | Handler | Auth? | Description |
|--------|------|---------|-------|-------------|
| GET | /login | LoginForm | No | Show login page |
| POST | /login | Login | No | Process login |
| GET | /register | RegisterForm | No | Show registration page |
| POST | /register | Register | No | Process registration |
| POST | /logout | Logout | Yes | Destroy session |

## Business Rules

- Passwords hashed with argon2id (memory-hard, GPU-resistant)
- Sessions stored in Redis with configurable TTL (default 30 days)
- Login rate limiting: max 5 attempts per minute per IP
- Email must be unique (case-insensitive)
- Password minimum 8 characters

## Current State

- [ ] .ai.md created
- [ ] Handler scaffolded
- [ ] Service implemented
- [ ] Repository implemented
- [ ] Templates created
- [ ] Tests written
- [ ] Auth middleware implemented
- [ ] Integrated with main router

## Notes

- 2FA/TOTP is planned for Phase 3, not Phase 1.
- API token auth (Personal Access Tokens) is separate from session auth.
