# Admin Plugin

## Purpose

Site-wide administration for Chronicle. Provides a dashboard with overview stats,
user management (toggle admin flag), and campaign oversight (force-delete, join as
any role, leave). All routes require the `is_admin` flag via `RequireSiteAdmin` middleware.

## Tier

Plugin (Infrastructure -- admin-only)

## Domain Concepts

- **Site Admin:** A user with `users.is_admin = true`. Can access `/admin/*` routes.
- **Admin Join:** Admin can join any campaign as Player, Scribe, or Owner. Joining
  as Owner triggers a force-transfer (current owner demoted to Scribe).
- **Admin Force-Delete:** Admin can delete any campaign from the admin panel.

## Files

| File | Purpose |
|------|---------|
| handler.go | Dashboard, Users, ToggleAdmin, Campaigns, DeleteCampaign, JoinCampaign, LeaveCampaign |
| routes.go | /admin group with auth + admin middleware, delegates SMTP routes |
| dashboard.templ | Overview stats (user count, campaign count, SMTP status) |
| users.templ | Paginated user list with admin toggle buttons |
| campaigns.templ | All campaigns with join/leave/delete actions |

## Dependencies

- **Uses:** auth (UserRepository for user CRUD, AuthService for middleware), campaigns (CampaignService for campaign operations), smtp (SMTPService for status, Handler for settings routes)
- **Used by:** None (top-level admin interface)

## Routes

| Method | Path | Handler | Description |
|--------|------|---------|-------------|
| GET | /admin | Dashboard | Overview stats |
| GET | /admin/users | Users | User management |
| PUT | /admin/users/:id/admin | ToggleAdmin | Toggle admin flag |
| GET | /admin/campaigns | Campaigns | All campaigns |
| DELETE | /admin/campaigns/:id | DeleteCampaign | Force-delete |
| POST | /admin/campaigns/:id/join | JoinCampaign | Admin joins with role |
| DELETE | /admin/campaigns/:id/leave | LeaveCampaign | Admin leaves |
| GET | /admin/smtp | (SMTP handler) | SMTP settings |
| PUT | /admin/smtp | (SMTP handler) | Save SMTP settings |
| POST | /admin/smtp/test | (SMTP handler) | Test SMTP connection |

## Current State

- [x] .ai.md created
- [x] Handler implemented
- [x] Routes defined
- [x] Templates created (dashboard, users, campaigns)
- [x] RequireSiteAdmin middleware created
- [x] Integrated with main router
- [ ] Tests written
